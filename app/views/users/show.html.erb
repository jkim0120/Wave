<%= javascript_tag do %>
  var firebase = new Firebase(firebaseUrl)
  firebase.child('users').child(gon.userId).child('notifications').child('friend_requests').child(currentUser.id).on('child_removed', function(removed) {
    $.ajax({
      url: `/users/${ gon.userId }/update_friends`,
      method: 'get',
      dataType: 'script'
    })
  })
  firebase.child('users').child(gon.userId).child('notifications').child('friend_requests').child(currentUser.id).on('child_changed', function(changed) {
    $.ajax({
      url: `/users/${ gon.userId }/update_friends`,
      method: 'get',
      dataType: 'script'
    })
  })
<% end %>

<div class="avatar">
  <div class="image">
    <%= image_tag image_path(@user.avatar.profile) %>
  </div>
  <% if @user == current_user %>
    <div class="update-photo">
      <p>Update Photo</p>
    </div>
    <div class="hidden">
      <%= form_for @user, url: update_avatar_user_path(@user), html: { id: 'edit-avatar' }, multipart: true, remote: true do |f| %>
        <%= f.file_field :avatar %>
        <%= f.submit 'Update Photo' %>
      <% end %>
    </div>
  <% end %>
</div>

<div class="name">
  <h3><%= @user.first_name %> <%= @user.last_name %></h3>
</div>

<div class="modal">
  <%= link_to "Wave!", user_wave_sessions_path(@user.id), method: :post, remote: true, 'data-type' => :html %>
  <input class="hidden modal-state" id="modal-1" type="checkbox" />
  <div class="modal-fade-screen">
    <div class="modal-inner">
      <div class="modal-close" for="modal-1"></div>
      <div class="modal-content"></div>
    </div>
  </div>
</div>

<% unless @user == current_user || current_user.nil? %>
  <div class="friend-status">
    <%= render 'friend_status' %>
  </div>
<% end %>

<% if !current_user.nil? %>
  <div class="user-progress">
    <%= render 'stats/progress' %>
  </div>
<% end %>
